<?php
// Hardcoded table data
$tableData = [
    ['GLOBAL' => '', '2021' => 'Q1_21', '2018' => ''],
    ['GLOBAL' => '', '2021' => 'Q2_21', '2018' => ''],
    ['GLOBAL' => '', '2021' => 'Q2B_21', '2018' => ''],
    ['GLOBAL' => '', '2021' => '', '2018' => 'Q1_18'],
    ['GLOBAL' => 'Q1', '2021' => 'Q3_21', '2018' => 'Q2_18'],
    ['GLOBAL' => 'Q1B', '2021' => 'Q3B_21', '2018' => ''],
    ['GLOBAL' => 'Q2', '2021' => 'Q4_21', '2018' => 'Q4_18'],
    ['GLOBAL' => 'Q3A', '2021' => 'Q5A_21', '2018' => 'Q3A_18'],
    ['GLOBAL' => 'Q3B', '2021' => 'Q5B_21', '2018' => 'Q3B_18'],
    ['GLOBAL' => 'Q3C', '2021' => 'Q5C_21', '2018' => 'Q3C_18'],
    ['GLOBAL' => 'Q3D', '2021' => 'Q5D_21', '2018' => 'Q3D_18'],
    ['GLOBAL' => 'Q3E', '2021' => 'Q5E_21', '2018' => 'Q3E_18'],
    ['GLOBAL' => 'Q3F', '2021' => 'Q5F_21', '2018' => 'Q3F_18'],
    ['GLOBAL' => 'Q3G', '2021' => 'Q5G_21', '2018' => 'Q3G_18'],
    ['GLOBAL' => 'Q3H', '2021' => 'Q5H_21', '2018' => 'Q3H_18'],
    ['GLOBAL' => 'Q3I', '2021' => 'Q5I_21', '2018' => 'Q3I_18'],
    ['GLOBAL' => 'Q3J', '2021' => 'Q5J_21', '2018' => 'Q3J_18'],
    ['GLOBAL' => 'Q3K', '2021' => 'Q5K_21', '2018' => 'Q3K_18'],
    ['GLOBAL' => '', '2021' => '', '2018' => 'Q5_18'],
    ['GLOBAL' => 'Q4', '2021' => 'Q6_21', '2018' => 'Q6_18'],
    ['GLOBAL' => 'Q5', '2021' => 'Q7A_21', '2018' => 'Q7_18'],
    ['GLOBAL' => '', '2021' => 'Q7B_21', '2018' => ''],
    ['GLOBAL' => 'Q6A', '2021' => 'Q8A_21', '2018' => 'Q8A_18'],
    ['GLOBAL' => 'Q6B', '2021' => 'Q8B_21', '2018' => 'Q8B_18'],
    ['GLOBAL' => 'Q6C', '2021' => 'Q8C_21', '2018' => 'Q8E_18'],
    ['GLOBAL' => 'Q6D', '2021' => 'Q8D_21', '2018' => 'Q8F_18'],
    ['GLOBAL' => 'Q6E', '2021' => 'Q8E_21', '2018' => 'Q8G_18'],
    ['GLOBAL' => '', '2021' => '', '2018' => 'Q8C_18'],
    ['GLOBAL' => '', '2021' => '', '2018' => 'Q8D_18'],
    ['GLOBAL' => 'Q7', '2021' => 'Q9_21', '2018' => 'Q9_18'],
    ['GLOBAL' => 'Q8', '2021' => 'Q10_21', '2018' => 'Q11_18'],
    ['GLOBAL' => '', '2021' => '', '2018' => 'Q10A_18'],
    ['GLOBAL' => '', '2021' => '', '2018' => 'Q10B_18'],
    ['GLOBAL' => '', '2021' => '', '2018' => 'Q10C_18'],
    ['GLOBAL' => '', '2021' => '', '2018' => 'Q10D_18'],
    ['GLOBAL' => '', '2021' => '', '2018' => 'Q10E_18'],
    ['GLOBAL' => '', '2021' => '', '2018' => 'Q10F_18'],
    ['GLOBAL' => '', '2021' => '', '2018' => 'Q10G_18'],
    ['GLOBAL' => 'Q9', '2021' => 'Q11_21', '2018' => ''],
    ['GLOBAL' => '', '2021' => 'Q12_21', '2018' => ''],
    ['GLOBAL' => 'Q10A', '2021' => 'Q13A_21', '2018' => 'Q12A_18'],
    ['GLOBAL' => 'Q10B', '2021' => 'Q13B_21', '2018' => 'Q12B_18'],
    ['GLOBAL' => 'Q10C', '2021' => 'Q13C_21', '2018' => 'Q12C_18'],
    ['GLOBAL' => 'Q10D', '2021' => 'Q13D_21', '2018' => 'Q12D_18'],
    ['GLOBAL' => 'Q10E', '2021' => 'Q13E_21', '2018' => 'Q12E_18'],
    ['GLOBAL' => 'Q10F', '2021' => 'Q13F_21', '2018' => 'Q12F_18'],
    ['GLOBAL' => 'Q10G', '2021' => 'Q13G_21', '2018' => 'Q12G_18'],
    ['GLOBAL' => 'Q10H', '2021' => 'Q13H_21', '2018' => 'Q12H_18'],
    ['GLOBAL' => 'Q10I', '2021' => 'Q13I_21', '2018' => ''],
    ['GLOBAL' => 'Q11A', '2021' => 'Q14A_21', '2018' => 'Q13A_18'],
    ['GLOBAL' => 'Q11B', '2021' => 'Q14B_21', '2018' => 'Q13B_18'],
    ['GLOBAL' => 'Q11C', '2021' => 'Q14C_21', '2018' => ''],
    ['GLOBAL' => 'Q11D', '2021' => 'Q14D_21', '2018' => ''],
    ['GLOBAL' => 'Q11E', '2021' => 'Q14E_21', '2018' => 'Q13D_18'],
    ['GLOBAL' => 'Q11F', '2021' => 'Q14F_21', '2018' => 'Q13E_18'],
    ['GLOBAL' => 'Q11G', '2021' => 'Q14G_21', '2018' => 'Q13F_18'],
    ['GLOBAL' => 'Q11H', '2021' => 'Q14H_21', '2018' => 'Q13G_18'],
    ['GLOBAL' => 'Q11I', '2021' => 'Q14I_21', '2018' => 'Q13H_18'],
    ['GLOBAL' => 'Q11J', '2021' => 'Q14J_21', '2018' => ''],
    ['GLOBAL' => 'Q11K', '2021' => 'Q14K_21', '2018' => ''],
    ['GLOBAL' => 'Q11L', '2021' => 'Q14L_21', '2018' => 'Q13I_18'],
    ['GLOBAL' => '', '2021' => '', '2018' => 'Q13C_18'],
    ['GLOBAL' => 'Q12', '2021' => 'Q15_21', '2018' => 'Q14_18'],
    ['GLOBAL' => 'Q12B', '2021' => 'Q15B_21', '2018' => 'Q14_18'],
    ['GLOBAL' => 'Q13', '2021' => 'Q16_21', '2018' => 'Q15_18'],
    ['GLOBAL' => '', '2021' => '', '2018' => 'Q16_18'],
    ['GLOBAL' => 'Q14', '2021' => 'Q17_21', '2018' => 'Q17_18'],
    ['GLOBAL' => 'Q15', '2021' => 'Q18_21', '2018' => 'Q18_18'],
    ['GLOBAL' => 'Q16', '2021' => 'Q19_21', '2018' => 'Q19_18'],
    ['GLOBAL' => 'Q17', '2021' => 'Q20_21', '2018' => ''],
    ['GLOBAL' => '', '2021' => 'Q21_21', '2018' => ''],
    ['GLOBAL' => '', '2021' => '', '2018' => 'Q20_18'],
    ['GLOBAL' => '', '2021' => 'Q22_21', '2018' => ''],
    ['GLOBAL' => 'Q18', '2021' => '', '2018' => ''],
    ['GLOBAL' => '', '2021' => '', '2018' => 'Q21A_18'],
    ['GLOBAL' => '', '2021' => '', '2018' => 'Q21B_18'],
    ['GLOBAL' => '', '2021' => '', '2018' => 'Q21C_18'],
    ['GLOBAL' => '', '2021' => '', '2018' => 'Q21D_18'],
    ['GLOBAL' => '', '2021' => '', '2018' => 'Q21E_18'],
    ['GLOBAL' => '', '2021' => '', '2018' => 'Q21F_18'],
    ['GLOBAL' => '', '2021' => '', '2018' => 'Q21G_18'],
    ['GLOBAL' => '', '2021' => '', '2018' => 'Q21H_18'],
    ['GLOBAL' => '', '2021' => '', '2018' => 'Q21I_18'],
    ['GLOBAL' => '', '2021' => '', '2018' => 'Q21J_18'],
    ['GLOBAL' => '', '2021' => '', '2018' => 'Q21K_18'],
    ['GLOBAL' => '', '2021' => '', '2018' => 'Q21L_18'],
    ['GLOBAL' => '', '2021' => '', '2018' => 'Q21M_18'],
    ['GLOBAL' => '', '2021' => '', '2018' => 'Q21N_18'],
    ['GLOBAL' => 'Q19A', '2021' => 'Q23A_21', '2018' => 'Q22_18'],
    ['GLOBAL' => 'Q19B', '2021' => 'Q23B_21', '2018' => 'Q23_18'],
    ['GLOBAL' => 'Q19C', '2021' => 'Q23C_21', '2018' => 'Q24_18'],
    ['GLOBAL' => '', '2021' => '', '2018' => 'Q25A_18'],
    ['GLOBAL' => '', '2021' => '', '2018' => 'Q25B_18'],
    ['GLOBAL' => '', '2021' => '', '2018' => 'Q25C_18'],
    ['GLOBAL' => 'Q20', '2021' => 'Q24_21', '2018' => 'Q26_18'],
    ['GLOBAL' => 'Q21', '2021' => 'Q25_21', '2018' => 'Q27_18'],
    ['GLOBAL' => 'Q21B', '2021' => 'Q25B_21', '2018' => 'Q27B_18'],
    ['GLOBAL' => '', '2021' => 'Q26A_21', '2018' => ''],
    ['GLOBAL' => '', '2021' => 'Q26B_21', '2018' => ''],
    ['GLOBAL' => 'Q22A', '2021' => 'Q27A_21', '2018' => 'Q29A_18'],
    ['GLOBAL' => 'Q22B', '2021' => 'Q27B_21', '2018' => 'Q29B_18'],
    ['GLOBAL' => 'Q22C', '2021' => 'Q27C_21', '2018' => 'Q29C_18'],
    ['GLOBAL' => 'Q22D', '2021' => 'Q27D_21', '2018' => 'Q29D_18'],
    ['GLOBAL' => 'Q22E', '2021' => 'Q27E_21', '2018' => 'Q29E_18'],
    ['GLOBAL' => 'Q22F', '2021' => 'Q27F_21', '2018' => 'Q29F_18'],
    ['GLOBAL' => 'Q22G', '2021' => 'Q27G_21', '2018' => 'Q29G_19'],
    ['GLOBAL' => 'Q22H', '2021' => 'Q27H_21', '2018' => ''],
    ['GLOBAL' => 'Q22I', '2021' => 'Q27I_21', '2018' => 'Q28_18'],
    ['GLOBAL' => 'Q22J', '2021' => 'Q27J_21', '2018' => 'Q29H_18'],
    ['GLOBAL' => 'Q23A', '2021' => 'Q28A_21', '2018' => ''],
    ['GLOBAL' => 'Q23B', '2021' => 'Q28B_21', '2018' => ''],
    ['GLOBAL' => 'Q23C', '2021' => 'Q28C_21', '2018' => ''],
    ['GLOBAL' => 'Q23D', '2021' => 'Q28D_21', '2018' => ''],
    ['GLOBAL' => 'Q23E', '2021' => 'Q28E_21', '2018' => ''],
    ['GLOBAL' => 'Q23F', '2021' => 'Q28F_21', '2018' => ''],
    ['GLOBAL' => 'Q23G', '2021' => 'Q28G_21', '2018' => ''],
    ['GLOBAL' => 'Q23H', '2021' => 'Q28H_21', '2018' => ''],
    ['GLOBAL' => 'Q23I', '2021' => 'Q28I_21', '2018' => ''],
    ['GLOBAL' => 'Q23J', '2021' => 'Q28J_21', '2018' => ''],
    ['GLOBAL' => 'Q23K', '2021' => 'Q28K_21', '2018' => ''],
    ['GLOBAL' => 'Q23L', '2021' => 'Q28L_21', '2018' => ''],
    ['GLOBAL' => 'Q23M', '2021' => 'Q28M_21', '2018' => ''],
    ['GLOBAL' => 'Q23N', '2021' => 'Q28N_21', '2018' => ''],
    ['GLOBAL' => 'Q23O', '2021' => 'Q28O_21', '2018' => ''],
    ['GLOBAL' => 'Q23P', '2021' => 'Q28P_21', '2018' => ''],
    ['GLOBAL' => 'Q23Q', '2021' => 'Q28Q_21', '2018' => ''],
    ['GLOBAL' => 'Q23R', '2021' => 'Q28R_21', '2018' => ''],
    ['GLOBAL' => 'Q24', '2021' => 'Q29_21', '2018' => ''],
    ['GLOBAL' => 'Q25A', '2021' => 'Q30A_21', '2018' => 'Q30A_18'],
    ['GLOBAL' => 'Q25B', '2021' => 'Q30B_21', '2018' => 'Q30B_18'],
    ['GLOBAL' => 'Q25C', '2021' => 'Q30C_21', '2018' => 'Q30C_18'],
    ['GLOBAL' => 'Q25D', '2021' => 'Q30D_21', '2018' => 'Q30D_18'],
    ['GLOBAL' => 'Q25E', '2021' => 'Q30E_21', '2018' => 'Q30E_18'],
    ['GLOBAL' => 'Q25F', '2021' => 'Q30F_21', '2018' => 'Q30F_18'],
    ['GLOBAL' => 'Q25G', '2021' => 'Q30G_21', '2018' => 'Q30G_18'],
    ['GLOBAL' => 'Q25H', '2021' => 'Q30H_21', '2018' => 'Q30H_18'],
    ['GLOBAL' => 'Q25I', '2021' => 'Q30I_21', '2018' => 'Q30I_18'],
    ['GLOBAL' => 'Q25J', '2021' => 'Q30J_21', '2018' => 'Q30J_18'],
    ['GLOBAL' => 'Q25K', '2021' => 'Q30K_21', '2018' => 'Q30K_18'],
    ['GLOBAL' => 'Q25L', '2021' => 'Q30L_21', '2018' => 'Q30L_18'],
    ['GLOBAL' => 'Q25M', '2021' => 'Q30M_21', '2018' => 'Q30M_18'],
    ['GLOBAL' => 'Q25N', '2021' => 'Q30N_21', '2018' => 'Q30N_18'],
    ['GLOBAL' => '', '2021' => '', '2018' => 'Q31_18'],
    ['GLOBAL' => '', '2021' => '', '2018' => 'Q32A_18'],
    ['GLOBAL' => '', '2021' => '', '2018' => 'Q32B_18'],
    ['GLOBAL' => '', '2021' => '', '2018' => 'Q32C_18'],
    ['GLOBAL' => '', '2021' => '', '2018' => 'Q32D_18'],
    ['GLOBAL' => '', '2021' => '', '2018' => 'Q32E_18'],
    ['GLOBAL' => '', '2021' => '', '2018' => 'Q32F_18'],
    ['GLOBAL' => '', '2021' => '', '2018' => 'Q32G_18'],
    ['GLOBAL' => '', '2021' => '', '2018' => 'Q32H_18'],
    ['GLOBAL' => '', '2021' => '', '2018' => 'Q32I_18'],
    ['GLOBAL' => '', '2021' => '', '2018' => 'Q32J_18'],
    ['GLOBAL' => '', '2021' => '', '2018' => 'Q32K_18'],
    ['GLOBAL' => '', '2021' => '', '2018' => 'Q32L_18'],
    ['GLOBAL' => '', '2021' => '', '2018' => 'Q32M_18'],
    ['GLOBAL' => '', '2021' => '', '2018' => 'Q32N_18'],
    ['GLOBAL' => '', '2021' => '', '2018' => 'Q33A_18'],
    ['GLOBAL' => '', '2021' => '', '2018' => 'Q33B_18'],
    ['GLOBAL' => '', '2021' => '', '2018' => 'Q33C_18'],
    ['GLOBAL' => 'Q26', '2021' => 'Q31_21', '2018' => 'Q34_18'],
    ['GLOBAL' => 'Q27', '2021' => 'Q32_21', '2018' => 'Q35_18'],
    ['GLOBAL' => 'Q27A', '2021' => 'Q32A_21', '2018' => 'Q35A_18'],
    ['GLOBAL' => 'Q27B', '2021' => 'Q32B_21', '2018' => 'Q35B_18'],
    ['GLOBAL' => 'Q27C', '2021' => 'Q32C_21', '2018' => 'Q35C_18'],
    ['GLOBAL' => 'Q27D', '2021' => 'Q32D_21', '2018' => 'Q35D_18'],
    ['GLOBAL' => 'Q28', '2021' => 'Q33_21', '2018' => 'Q36_18'],
    ['GLOBAL' => 'Q29', '2021' => 'Q34_21', '2018' => 'Q37_18'],
    ['GLOBAL' => 'Q30', '2021' => 'Q35_21', '2018' => ''],
    ['GLOBAL' => 'Q31', '2021' => 'Q36_21', '2018' => 'Q38_18'],
    ['GLOBAL' => 'Q31B', '2021' => 'Q36B_21', '2018' => 'Q38B_18'],
    ['GLOBAL' => 'Q32', '2021' => 'Q37_21', '2018' => 'Q39_18'],
    ['GLOBAL' => 'Q33', '2021' => 'Q38_21', '2018' => 'Q40_18'],
    ['GLOBAL' => 'Q33B', '2021' => 'Q38B_21', '2018' => 'Q40B_18'],
    ['GLOBAL' => 'Q34', '2021' => 'Q39_21', '2018' => 'Q41_18'],
    ['GLOBAL' => 'Q35', '2021' => 'Q40_21', '2018' => 'Q42_18']
];


function processFile($filename, $tableData) {
    // Check if the file exists
    if (!file_exists($filename)) {
        echo "Warning: File $filename does not exist.\n";
        return;
    }

    // Read the file into an array
    $lines = file($filename, FILE_IGNORE_NEW_LINES | FILE_SKIP_EMPTY_LINES);

    // Check if the file was successfully read
    if ($lines === false) {
        echo "Warning: Failed to open file $filename.\n";
        return;
    }

    // Process each line
    foreach ($lines as &$line) {
        // Split the line into columns
        $columns = str_getcsv($line);

        // Iterate through each row in the table data
        foreach ($tableData as $row) {
            // Check if the '2021' or '2018' value exists in the current line
            if (in_array($row['2021'], $columns) || in_array($row['2018'], $columns)) {
                // Check if the GLOBAL column is not null
                if (!empty($row['GLOBAL'])) {
                    $globalValue = $row['GLOBAL'];

                    // Check if the global value exists in any of the files
                    if (!valueExistsInFiles($globalValue)) {
                        // Replace values in the columns with the GLOBAL value
                        foreach ($columns as &$column) {
                            if ($column == $row['2021'] || $column == $row['2018']) {
                                $column = $globalValue;
                            }
                        }
                    }
                }
                break;
            }
        }

        // Reconstruct the line
        $line = implode(',', $columns);
    }

    // Write the modified lines back to the file
    file_put_contents($filename, implode(PHP_EOL, $lines));
}

function valueExistsInFiles($value) {
    $files = ['csv-2024.csv', 'csv-2021.csv', 'csv-2018.csv', 'src/docs/data.js'];
    foreach ($files as $file) {
        // Check if the file exists before reading
        if (file_exists($file)) {
            $content = file_get_contents($file);
            if (strpos($content, $value) !== false) {
                return true;
            }
        }
    }
    return false;
}

// Process each file
processFile('csv-2024.csv', $tableData);
processFile('csv-2021.csv', $tableData);
processFile('csv-2018.csv', $tableData);
processFile('src/docs/data.js', $tableData);

echo "Files processed successfully.";
